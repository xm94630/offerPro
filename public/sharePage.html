<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
  <title node-type="title">分享</title>
  <link rel="stylesheet" type="text/css" href="" node-type="css">
</head>
<body>

        <div class="page OfferEdit">
          <div class="picBox">
            <img node-type="pic1" src={offer} class="hidePic"/>
            <img node-type="pic2" src={pic} width="100%"/>
            <span node-type="reName" class="studentName2">{this.state.reName}</span>
          </div>
          <div class="canvasBox">
            <canvas id="myCanvas" width="100" height="100"></canvas>
          </div>  
          <div class="checkInfoBox2 MT15">
          <span node-type="myInfo">获得 {this.state.school} - {this.state.major} 录取offer！</span>
          </div>
          <div type="text" class="myInput submitBtn W80P MT10" onClick={this.shareFun}>分享喜悦</div>
          
          <div class="adImgBox" ref={(adBox) => { this.adBox = adBox; }} >
            <a node-type="goForm" href="/#/OfferForm">
              <img node-type="pic3" src={ad} width="100%"/>
            </a>
            <a node-type="goIndex" href="/#/">
              <img node-type="pic4" src={ad} width="100%"/>
            </a>
          </div>
        
          <Sharing show={this.state.shareBox}/>
        </div>

</body>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>

    //资源更新
    //这里一定要注意的是：
    //在本地项目中的时候，要把这个 baseUrl 修改正确（其实就是把资源这部分的用单独服务起来）
    //因为我们这里添加的页面和原来的单页面的资源引用有很大的差别呢。
    //在build之前一定要把资源处理正确呢~
    
    var baseUrl = 'http://192.168.1.100:9000';
    $('[node-type="pic1"]').attr('src', baseUrl+'/static/media/pic1.58566359.png');
    $('[node-type="pic2"]').attr('src', baseUrl+'/static/media/fontPic2.358f9fc3.png');
    $('[node-type="pic3"]').attr('src', baseUrl+'/static/media/ad.276cdccb.png');
    $('[node-type="pic4"]').attr('src', baseUrl+'/static/media/goIndex.238f1541.png');
    $('[node-type="css"]').attr('href', baseUrl+'/static/css/main.fcce6671.css')

    function getParameterByName(name, url) {
        if (!url) {
          url = window.location.href;
        }
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
    var offerId = getParameterByName('offerId',window.location.href);
    var l = function(){
      return console.log.apply(console,arguments)
    }


    //offer详情
    $.ajax({
        type: "GET",
        url: "http://os2017.51qiantu.com/offer/detail/"+offerId,
        dataType:"json",
        success: function(data){
          var data = data.ret;
          var imgNew = data.imgNew;
          var reName = data.reName;
          var school = data.school;
          var major = data.major;
          render(reName,imgNew,school,major);

          document.getElementsByTagName('title')[0].innerHTML = '【录取喜报】恭喜 '+reName+' 同学获得 '+school+' 录取OFFER！';

        }
    });

    function render(name,img,school,major){

      $('[node-type="reName"]').html(name);
      $('[node-type="myInfo"]').html('获得 '+school+' - '+major+' 录取offer！');

      if(localStorage.getItem('who')==='my'){
          //是为自己跳转过来的
          $('[node-type="goIndex"]').show();
          $('[node-type="goForm"]').hide();
          //清除
          localStorage.clear();
      }else{
          //是分享过来的
          $('[node-type="goIndex"]').hide();
          $('[node-type="goForm"]').show();
      }

      //canvas读取读片
      var ctx = document.getElementById('myCanvas').getContext("2d");
      //图片放大比例因子（这个参数会直接影响，canvas中图片的质量）
      var scaleImage = 4;
      var w = $(window).width()
      $('#myCanvas').attr("width",scaleImage*w).attr("height",scaleImage*w)
      var image = new Image();         
      image.src = 'http://os2017.51qiantu.com/'+img;  
      image.onload = function() {  
        ctx.drawImage(image, 0, 0,scaleImage * w,scaleImage * w);
      } 
    }
</script>

</html>